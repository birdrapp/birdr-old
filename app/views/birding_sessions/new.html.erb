<% content_for :js do %>
  <%= javascript_include_tag :add_bird_records %>
<% end %>

<div class="page-header">
  <div class="container">
    <h5 class="mb-0">Add bird records</h5>
  </div>
</div>

<div class="container">
  <%= simple_form_for(@birding_session) do |f| %>
  <%= f.association :user, as: :hidden, label: false, wrapper: false %>
  <div class="row">
    <div class="col-12 col-md-4">
      <h5>Date</h5>
      <p>
        <small>When did you go birding?</small>
      </p>
    </div>
    <div class="col-12 col-md-4">
      <div class="input-group">
        <%= f.input_field :date, required: false, as: :string, label: false, class: 'form-control' %>
        <span class="input-group-addon">
          <%= fa_icon :calendar %>
        </span>
      </div>
    </div>
  </div>
  <%= horizontal_rule %>
  <div class="row">
    <div class="col-12 col-md-4">
      <h5>Location</h5>
      <p>
        <small><b>Tip:</b> drag the marker for extra accuracy.</small>
      </p>
      <div class="input-group mb-2 search-box">
        <input id="search" placeholder="Search for a location..." class="form-control" />
        <span class="input-group-addon">
          <%= fa_icon :search, class: 'search-box-icon' %>
        </span>
      </div>
      <%= f.input :location, as: :hidden, label: false, wrapper: false %>
      <%= f.input :location_name, as: :hidden, label: false, wrapper: false %>
      <div id="geocodeSearchResults" class="birding_session-search-results"></div>
    </div>
    <div class="col-12 col-md-8">
      <div id="map" class="birding-session-map"></div>
    </div>
  </div>
  <%= horizontal_rule %>
  <div class="row">
    <div class="col-12 col-md-4">
      <h5>Birds</h5>
      <%= select_tag :birds, options_from_collection_for_select(@birds, :id, :localized_name), include_blank: 'Select a bird', class: 'form-control', id: 'birdSearch' %>
    </div>
    <div class="col-12 col-md-4">
      <ul class="list-group" id="birdRecords"></ul>
    </div>
  </div>
  <div class="row">
    <div class="col-12 col-md-4">
      <%= f.button :submit, 'Save Bird Records', class: 'btn-primary mb-5 mt-4' %>
    </div>
  </div>
  <% end %>
</div>

<script id="birdRecordResultTemplate" type="text/x-handlebars-template">
  <li id="{{id}}" class="list-group-item justify-content-right birding-session-bird-result">
    {{name}}
    <input value="{{id}}" class="form-control hidden" type="hidden" name="birding_session[bird_records_attributes][{{index}}][bird_id]" id="birding_session_bird_records_attributes_{{index}}_bird_id">
    <a href="#" class="remove-bird text-danger">
      <span aria-hidden="true" class="float-right">&times;</span>
    </a>
  </li>
</script>
